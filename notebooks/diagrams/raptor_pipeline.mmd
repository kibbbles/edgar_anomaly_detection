flowchart TD
    Start([Start: Raw 10-K/10-Q Filing]) --> Extract[Extract Text from HTML/XML]
    Extract --> Chunk[Chunk Document<br/>RecursiveCharacterTextSplitter<br/>2000 tokens/chunk]
    Chunk --> Embed1[Generate Embeddings<br/>Sentence Transformers]

    Embed1 --> GlobalCluster[Global Clustering<br/>UMAP + GMM]
    GlobalCluster --> LocalCluster[Local Clustering<br/>Refine within each cluster]

    LocalCluster --> Summarize1[Level 1 Summarization<br/>Cluster summaries]
    Summarize1 --> Embed2[Embed Level 1 Summaries]

    Embed2 --> Cluster2[Level 2 Clustering<br/>UMAP + GMM]
    Cluster2 --> Summarize2[Level 2 Summarization<br/>Summary of summaries]

    Summarize2 --> Embed3[Embed Level 2 Summaries]
    Embed3 --> Cluster3[Level 3 Clustering<br/>UMAP + GMM]
    Cluster3 --> Summarize3[Level 3 Summarization<br/>Highest abstraction]

    Summarize3 --> Combine[Combine All Levels<br/>Original chunks + L1/L2/L3 summaries]
    Combine --> Store[Store in Knowledge Base<br/>ChromaDB]
    Store --> End([Knowledge Base Ready])

    style GlobalCluster fill:#ffeb3b,stroke:#fbc02d,stroke-width:2px
    style LocalCluster fill:#ffeb3b,stroke:#fbc02d,stroke-width:2px
    style Summarize1 fill:#9c27b0,stroke:#7b1fa2,stroke-width:2px
    style Summarize2 fill:#9c27b0,stroke:#7b1fa2,stroke-width:2px
    style Summarize3 fill:#9c27b0,stroke:#7b1fa2,stroke-width:2px
    style Store fill:#4caf50,stroke:#388e3c,stroke-width:3px
